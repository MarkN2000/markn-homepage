{{/* layouts/_default/card.html */}}
<div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden flex flex-col">
    <a href="{{ .RelPermalink }}" class="block">
        <div class="aspect-video bg-gray-200">
            {{ $cardImage := "" }}
            {{ $imageProcessed := "" }}
            {{/* 1. フロントマターのthumbnailをページリソースとして探す */}}
            {{ if .Params.thumbnail }}
                {{ with .Resources.GetMatch .Params.thumbnail }}
                    {{ $cardImage = . }}
                {{ end }}
            {{ end }}

            {{/* 2. (オプション) thumbnailがなければ、バンドル内の最初の一致する画像を探す (例: featured.* or cover.*) */}}
            {{/* {{ if not $cardImage }}
                {{ $cardImage = .Resources.GetMatch "{featured,cover}.*" }}
            {{ end }} */}}

            {{ if $cardImage }}
                {{/* ページリソースが見つかればHugoの画像処理を適用 */}}
                {{ $imageProcessed = $cardImage.Fill "480x270 webp" }}
                <img src="{{ $imageProcessed.RelPermalink }}" width="{{ $imageProcessed.Width }}" height="{{ $imageProcessed.Height }}" alt="{{ .Title }} のサムネイル" class="w-full h-full object-cover">
            {{ else if .Params.thumbnail }}
                {{/* ページリソースではないがthumbnailパスが指定されている場合 (例: /images/static.png) */}}
                {{ if strings.HasPrefix .Params.thumbnail "/" }}
                    <img src="{{ .Params.thumbnail | relURL }}" alt="{{ .Title }} のサムネイル" class="w-full h-full object-cover">
                {{ else }}
                    {{/* 相対パスだがリソースでない場合はプレースホルダー (またはエラー表示) */}}
                    <img src="https://via.placeholder.com/480x270.png?text=Image+Not+Found" alt="{{ .Title }} のサムネイル" class="w-full h-full object-cover">
                {{ end }}
            {{ else }}
                {{/* サムネイル指定が全くない場合は汎用プレースホルダー */}}
                <img src="https://via.placeholder.com/480x270.png?text={{ .Title | truncate 15 }}" alt="{{ .Title }} のサムネイル" class="w-full h-full object-cover">
            {{ end }}
        </div>
    </a>
    
    {{/* カードコンテンツエリア */}}
    <div class="p-4 flex flex-col flex-grow"> {{/* flex flex-col flex-grow を追加 */}}
        <h3 class="text-lg font-semibold text-gray-800 mb-2 line-clamp-2">
        <a href="{{ .RelPermalink }}" 
            class="block text-sm text-gray-700 hover:text-primary mb-3 line-clamp-3 flex-grow transition-colors duration-150"
            aria-label="記事「{{ .Title }}」の概要を読む">
            {{ .Summary | plainify | truncate 100 }}
        </a>
        
        {{/* タグ表示エリア */}}
        {{ if .Params.tags }}
        <div class="mt-auto pt-2 border-t border-gray-100"> {{/* mt-auto で下寄せ、区切り線 */}}
            <div class="flex flex-wrap gap-1">
            {{ range .Params.tags }}
                <a href="{{ "tags" | absURL }}/{{ . | urlize }}/" class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-0.5 rounded transition-colors">{{ . }}</a>
            {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
</div>