---
title: "Resonite玄人向けアバターセットアップ方法"
date: 2025-12-04T23:00:00+09:00
draft: true
thumbnail: "thumbnail.webp"
thumbnail_alt: "Resoniteアバターセットアップ"
tags: ["Resonite", "解説", "アバター"]
description: "Resonite玄人向けのMarkN流アバターセットアップ方法について紹介します。意図しない動作をさせない・他人のFPSを低下させない（軽量化）ことを重視しています"
---

こんにちは、「まーくん。(MarkN)」です

この記事では、Resoniteの玄人向けにMarkN流のアバターセットアップ方法を紹介します

## 目次
- [はじめに](#はじめに)
- [NoIKの設定](#noikの設定)
- [椅子で腰がひっくり返る](#椅子で腰がひっくり返る)
- [椅子やフルトラで首が伸びないように](#椅子やフルトラで首が伸びないように)
- [極端なスケールにならないようにする](#極端なスケールにならないようにする)
- [モデルインポート](#モデルインポート)
- [アバタークリエイター](#アバタークリエイター)
- [コライダー](#コライダー)
- [指先のタッチ判定位置](#指先のタッチ判定位置)
- [レーザーのヒゲの奥行きを合わせる](#レーザーのヒゲの奥行きを合わせる)
- [スカート貫通](#スカート貫通)
- [ボーンを掴んだり伸ばしたりできるように](#ボーンを掴んだり伸ばしたりできるように)
- [FPSと距離に応じて軽量化](#fpsと距離に応じて軽量化)
- [落下時やアバターを持ったときに足が頭の上まで上がるのを防ぐ](#落下時やアバターを持ったときに足が頭の上まで上がるのを防ぐ)
- [LOD](#lod)
- [バウンディングボックス](#バウンディングボックス)
- [アイトラッキング](#アイトラッキング)
- [フェイシャル](#フェイシャル)
- [表情切り替え](#表情切り替え)
- [足の接地](#足の接地)
- [未使用ボーン・シェイプキー削除](#未使用ボーン・シェイプキー削除)
- [メッシュベイク](#メッシュベイク)
- [テクスチャ](#テクスチャ)
- [マテリアル](#マテリアル)
- [ロコモーション](#ロコモーション)

## はじめに

私の理解に誤りがある可能性もあるため、この記事を盲信しないでください。

この記事のセットアップは主に **意図しない動作をさせない・他人のFPSを低下させない** ことを重視しています。

具体的な実装方法までは解説しきれていない部分も多いため、以下の私がセットアップしたアバターを分解しながら読むことをおすすめします。
<a href="https://uni-pocket.com/ja/items/cd78af9f-3f05-4da8-b499-a477111c2f8f " class="dynamic-link-card"></a>

また、Resoniteで作業する際はこまめにインベントリにバックアップを保存するようにしましょう。

以下のサイトも参考になるので、ぜひ目を通してみてください。
<a href="https://wikiwiki.jp/resonaito/%E9%80%B8%E8%88%AC%E4%BA%BA%E5%90%91%E3%81%91%E3%82%A2%E3%83%90%E3%82%BF%E3%83%BC%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97" class="dynamic-link-card"></a>
<a href="https://wikiwiki.jp/resonaito/%E3%82%A2%E3%83%90%E3%82%BF%E3%83%BC%E6%9C%80%E9%81%A9%E5%8C%96Tips" class="dynamic-link-card"></a>

初心者の方はネット上の初心者向け記事を参考にするか、Resonite内でメンターなどに手伝ってもらってください。
この記事で紹介するのは応用的な内容ばかりですので、おそらく何を言っているのかわからないと思います。

<b>初心者の方はこの記事は無視</b>して、まずは簡単なところから楽しく気楽にセットアップを楽しみましょう。

## NoIKの設定

アバターのボーンがResoniteの推奨する構造・命名になっていない場合は、Blender等で修正しましょう。

`UpperChest` 等があると `hips` の位置を誤認してしまいます。
不必要なボーンがある場合は、ボーンの名前に `<NoIK>` とつけることで無視させることができます。

*   例：`UpperChest<NoIK>` `UpperChest<NOIK>` `<noik>UpperChest`

![alt text](rapture_20251126191101.jpg)

表記がResoniteの推奨に合っていない場合も書き直しましょう。

*   例：`ヒップ`や`hip` ⇒ `hips`

表記と位置が合っていない場合は、いい感じに辻褄を合わせてください。

### Resoniteが推奨する構造
![alt text](<https://wiki.resonite.com/images/5/53/IK_Rig_Bones.png>)

詳細を知りたい場合は公式Wikiを参照してください。
<a href="https://wiki.resonite.com/Humanoid_rig_requirements_for_IK" class="dynamic-link-card"></a>

### hipsの位置を誤認している例

足元にhipsがあるため、椅子に座ると浮いてしまいます。
![alt text](<2025-11-24 17.17.42.webp>)

hipsとspineの距離を元にhipsコライダーを生成するため、足元から胸あたりまである巨大コライダーが生成され、デスクトップモードで手が浮いてしまいます。
![alt text](<2025-11-26 19.51.29.webp>)

## 椅子で腰がひっくり返る

hipsボーンとspineボーンが十分離れていないと、椅子に座った際に少し頭を下げるだけで腰がひっくり返ります。
![alt text](<2025-11-24 17.16.11.webp>)

Blender等でhipsをspineから離しましょう。

**元の位置**：ほぼ重なっている状態
![alt text](rapture_20251126180359.jpg)

**修正後**：Blenderの編集モードでhipsボーンを少し下げます
![alt text](rapture_20251126180459.jpg)

これで、きれいに座れるようになります。
![alt text](<2025-11-24 17.20.55.webp>)

## 椅子やフルトラで首が伸びないように

何も設定していないとよく首が伸びてしまいます（伸びて見えるのは自分からだけかもしれません）。

![alt text](<2025-11-24 17.19.15.webp>)

アバタールートにある `VRIKAvatar` コンポーネントの `HeadMaxFixDistance` を `0.001` のように小さな値にします。
（画像では `1E-07` つまり `0.00000001` になっています。`0` にしても良いと思います。）

こうすることで伸びなくなります。

![alt text](<2025-11-26 17.19.45.webp>)

## 極端なスケールにならないようにする

アバタールートやMeshRenderer、ボーンのスケールが **1に近い値** になるようにしましょう。あえて1以外にするメリットはほとんどありません。

スケールがバラバラだとアウトラインの幅などが不均一になったり、ボーンの中にスロットを入れる系のアイテムの一部で問題が起きたりします。

![alt text](<2025-11-24 17.28.00.webp>)

アバタールートのスケールが `0.01` などになっている場合は、一度Blenderで開きましょう。

1.  まずはBlender上で大きさが **0.3~2.0mくらい** (使用予定の身長に近い値)になっているのを確認します。
2.  なっていなければスケールを変えて、**スケールの適用** を行います。

![alt text](rapture_20251126180724.jpg)

エクスポート形式は **fbx** が無難です。
本当はglb(gltf)をおすすめしたいのですが、アバターの場合シェイプキーで法線が崩れがちだったりと挙動が不安定な場合があるため、アバターに限りfbxをおすすめしています。

fbxでエクスポートをする際は、以下の画像や設定を参考にしてください。

*   **内容**: カメラやボックスが含まれないように設定してください。
*   **スケールを適用**: 「FBX単位スケール」にしてください。
*   **向き**: `-z` が前、`+y` が上 です。
*   **幾何学（Geometry）**: 「三角面化」はこの段階ではしない方がいいです。
*   **アーマチュア**: 「リーフボーン」は基本的につけなくていいです。アバター作者さんが適切に作ってくれているはずです。

![alt text](rapture_20251126181444.jpg)

## モデルインポート

自分のスケールを **1** にしてインポートしましょう。
基本的には **ユーザースケール** でのインポートを推奨します。

アバターのアセットはスロット内に格納しましょう。

## アバタークリエイター

アバタークリエイターの頭や手の位置は、ギズモやインスペクターでの数値入力で動かせます。
ドライブされているので動かせないと思いがちですが、普通に調整可能です。グラブして動かすよりも正確に移動・回転できるのでおすすめです。

動かしてもよいスロットは以下の通りです：
*   `Headset`
*   `LeftHand`
*   `RightHand`
*   `Tooltip`
*   `Shelf`
*   `Grabber`

![alt text](<2025-11-27 17.51.41.webp>)

ヘッドの位置は2つの丸い玉を基準に考えてください。
この２つの丸い玉の間がViewPointとなります。

*   **高さ**: アバターの目に合わせる
*   **前後**: 鼻先と同じくらいにする

これらがおすすめですが、好みが大きいので自分に合う位置を探してください。
ヘッドの位置を変更したら、もう一度アバタークリエイターのボタン6個を押し直すと微妙なズレがきれいになります。
![alt text](<2025-11-24 17.34.19.webp>)

アバタークリエイターを小さくするとグラブエリアが小さくなり、物が掴みづらくなってしまいます。
基本的にアバタークリエイターのスケールはそのままか、変えるとしても少し小さいくらいが良いでしょう（手の大きさを合わせる必要はありません）。

**ツールの位置はデフォルトから変更しないことをおすすめします。**
ツールの位置を変更してしまうとコントローラーに対するレーザーの位置や向きが変わってしまいます。アバターを着替えるたびにレーザーの位置や向きが変化すると直感的な操作が難しくなるため、基本的にそのままで、動かすとしても回転はいじらない方が良いです。
![alt text](<2025-11-24 17.31.51.webp>)

## コライダー

アバターのコライダーは、掴む際はもちろん、以下のような様々な場面で使用されます。

*   銃のあたり判定
*   トマト投げのあたり判定
*   アバターをよじ登る判定
*   体に落書きするときの判定
*   自動ドアの安全機能

そのため、しっかり設定しましょう。コライダーを可視化すると調整が楽になります。

また、アバターのコライダーは距離に応じて切り替わります。
アバターを着ている側のスケール基準で **2m以内** だと全身のコライダーがアクティブになり、**2m以上** 離れると全身を覆う1つのコライダーのみになり処理負荷の軽減が図られています。

後からコライダーを追加すると、離れた際にオフにならない場合があります。
もし追加した場合は、コライダーを `rigCollidersEnabledStates` に追加して、離れたらオフになるように設定しましょう。

こちらのサイトで詳しく解説されています。
<a href="https://wikiwiki.jp/resonaito/%E9%80%B8%E8%88%AC%E4%BA%BA%E5%90%91%E3%81%91%E3%82%A2%E3%83%90%E3%82%BF%E3%83%BC%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97#hd62314d" class="dynamic-link-card"></a>

**調整前**：腰コライダーが小さかったり、手のコライダーが傾いていたりします。外側のコライダーも少し大きすぎます。
![alt text](<2025-11-24 17.25.46.webp>)

**調整後**：いい感じです。
![alt text](<2025-11-24 17.24.37.webp>)

## 指先のタッチ判定位置

デフォルトでは指先のタッチ位置が関節にあることが多く、指を貫通させないとボタンが押せないことがあります。
（リーフボーンをつけるなどして指先に指の名前がついたスロットが存在すれば、自動で指先にタッチ位置が来ます）

このように指を貫通させないとボタンが押せません。
![alt text](<2025-11-24 17.50.24.webp>)

**修正手順**:
1.  人差し指の `TipTouchSource` コンポーネントがついているスロットを探します。
2.  そのスロットの子供に新しくスロットを作り、指先に移動させます。
3.  `TipTouchSource` がついているスロットにあるコンポーネントを、すべて新しく作ったスロットに移動させます（コピーではなく移動）。

![alt text](<2025-11-24 17.47.19.webp>)

これで指先でボタンが押せるようになります。
![alt text](<2025-11-24 17.49.47.webp>)

## レーザーのヒゲの奥行きを合わせる

アバターのスケールによって、レーザーのヒゲが出る位置が前後にズレてしまうことがあります。

アバターを着てスケールリセットした状態で位置を調整しましょう。
`hand` の中にある `Tool Anchor` のスケールを調整することでヒゲの位置が変化します。
![alt text](<2025-11-24 17.44.40.webp>)

調整すると、ちゃんと真横に出るようになります。
![alt text](<2025-11-24 17.43.23.webp>)

## スカート貫通
Resoniteで貫通対策を完璧に行うのは大変なので、比較的簡単にできる方法を紹介します。

しゃがんだ時に、スカートが足に当たって持ち上がってしまう現象です。
![alt text](<2025-11-24 17.52.47.webp>)

これは、大きなボーンコライダーを足につけることで対策しています。
![alt text](<2025-11-24 17.53.51.webp>)

また、横のスカートが足より内側に来ないように、このようなコライダーもつけています。
![alt text](<2025-11-24 17.57.22.webp>)

## ボーンを掴んだり伸ばしたりできるように

アホ毛を引っ張ったり、スカートをめくったりしたいですよね。
![alt text](<2025-11-24 17.59.36.webp>)

*   **掴めるようにする**: `DynamicBoneChain` コンポーネントの `IsGrabbable` にチェックを入れます。
*   **伸びるようにする**: `MaxStretchRatio` を1以上に設定すると、その分だけ伸びるようになります。

掴めない場合は、`VisualizeColliders` にチェックをつけてコライダーの球体が小さすぎないか確認してください。コライダーの半径を設定する項目もあります。
![alt text](<2025-11-24 18.00.47.webp>)

## FPSと距離に応じて軽量化

`DynamicBone` は計算負荷があり、FPSが低くなると荒ぶることがあります（大人数の集合写真などでスカートや髪が痙攣したように震える現象）。

そのため、`ValueGradientDriver<bool>` と `ValueMultiDriver<bool>` を組み合わせて、**一定以下のFPSになったら `DynamicBoneChain` コンポーネントのEnableが切れる** ように設定しましょう。

余裕があれば、Enableが頻繁に切り替わって負荷が増えないように **ヒステリシス制御**（例：20fpsまで下がったらOFF、25fpsまで上がったらONというように、行き帰りで切り替え地点を変える制御）を導入しましょう。
`BooleanValueDriver<float>` で `ValueGradientDriver<bool>` のPositionをドライブして、`BooleanValueDriver<float>` のstateを `ValueMultiDriver<bool>` でドライブすることで実装できます。

**動作例**: 見ているユーザーのFPSによってDynamicBoneのON/OFFが変化します。
![alt text](<2025-11-26 15.11.13.webp>)
![alt text](<2025-11-26 15.11.23.webp>)

距離でのON/OFFも実装したい場合はさらに複雑になるので、参考アバター（つみれちゃん）を分解して確認するかMarkNに聞いてください。
![alt text](<2025-11-26 17.13.40.webp>)

## 落下時やアバターを持ったときに足が頭の上まで上がるのを防ぐ

以下の値を設定します。

*   `FeetHoverHeight`: `0`
*   `MaxFeetVelocityOffset`: `0.05` ~ `0.00` くらい (画像では `0.03`)

![alt text](<2025-11-26 17.19.45.webp>)

## LOD

画面に対して表示しているメッシュのバウンディングボックスの大きさの割合が一定以下になったら、表示を消す機能です。

アバターが画面の数ピクセルにしか映っていないのに、時計や指輪などを律儀に描画するのは計算資源の無駄ですし、チラチラ点滅してしまいます。ある程度小さくなったら見えなくなるようにしましょう。

**設定方法**:
1.  `LODGroup` コンポーネントをつけます。
2.  `LODs(list)` でAddを押し、`Renderers(list)` に制御したいレンダラーを入れます。
3.  `ScreenRelativeTransitionHeight` の値を、レンダラーを消したい値に設定します（例：画面の高さの1%以下になった時に消したければ `0.01`）。

詳細はこちらの記事を参考にしてください。
<a href="https://wikiwiki.jp/resonaito/Rendering/LODGroup" class="dynamic-link-card"></a>

## バウンディングボックス

バウンディングボックスはLODの計算や、そのメッシュが視界に入っているかどうかの計算に使用されています。
ボーン一つ一つの動きをリアルタイムに計算すると負荷が高くなるので、できるだけ数を少なく、計算回数も減らしましょう。ただし、スキンドメッシュが変形する範囲よりも小さくしてしまうと、目に映っているのに描画されないなどの問題が起きるので注意が必要です。

**注意**: 現在（2025年12月4日時点）、スキンドメッシュレンダラーのバウンディングボックスの計算にバグがあるらしく、設定が正しく動作していません。デフォルト設定では正しく動作していそうなのですが、いくつかの設定がおかしくなっています。
（まだIssueを書いていないので、誰か書ける人はお願いします。）
<a href="https://github.com/Yellow-Dog-Man/Resonite-Issues" class="dynamic-link-card"></a>

そのため、現在は `BoundsComputeMethod` の手動設定は行わずに **デフォルトの `static` のまま** にしましょう。
本来は `Proxy` や `Explicit` などに設定して最適化することが望ましいのですが、バグが直るまでは `static` 推奨です。
![alt text](<2025-12-03 18.47.05.webp>)

## アイトラッキング

目が既にキョロキョロ動いているのなら、視線に関しては特に難しい設定はなく動くはずです。
`EyeRotationDriver` の `MaxSwing` で目の可動範囲を自然な値に設定しましょう。

瞬きは、両目同時に閉じるシェイプキーを使うと片目閉じができません。左右に分かれているものを使いましょう。

**設定例**:
*   `EyeLinearDriver` の `Eyes(list)` をAddで増やし、`Left` と `Right` の2つを用意します。
*   `OpenCloseTarget` に左右の目閉じシェイプキーをそれぞれ設定します。

![alt text](<2025-12-03 19.02.36.webp>)

両目閉じしかなくても、Resonite内でシェイプキーを左右に分割することが可能です。
`SkinnedMeshRenderer` の目的のブレンドシェイプの左側の三本線をクリックし、メニューから `ブレンドシェイプをX軸で分割` を選択してください（左右がX軸のアバターの場合）。
![alt text](<スクリーンショット 2025-12-03 190958.webp>)

## フェイシャル

アバタークリエイターで「フェイシャルを設定」にチェックを付けていれば、あいうえお（Viseme）に関しては自動で設定されます。

チェックし忘れていた場合は、`AvatarMouthDataSourceAssigner` コンポーネントを付け、`TargetReference` に元々ついている `DirectVisemeDriver` の `MouthTrackingSource` の項目名を掴んで入れてください。
![alt text](<2025-12-02 21.47.23.webp>)
![alt text](<2025-12-02 21.47.32.webp>)

## 表情切り替え

`StandardController` ノード系を使用した表情設定（表情設定ツールなど）は便利ですが、今のResoniteで軽さを求めるなら `AvatarRawToolData` コンポーネントを使いましょう。

`StandardController` Fluxノードと `AvatarRawToolData` コンポーネントを esnyaさんのMOD `ResoniteMetricsCounter` で比較すると、Fluxの方が30倍ほど計算時間が長いです。
5000個複製した際のFPSやRenderTimeの比較は以下の通りです（FPSが低い方がFlux）。

![alt text](<2025-12-04 17.57.46.webp>)
![alt text](<2025-12-04 17.59.09.webp>)

圧倒的な差があります。比較に使用した実装は以下の通りです。

**コンポーネント**
![alt text](<2025-11-26 23.14.55.webp>)

**Flux**
![alt text](<2025-11-26 23.07.43.webp>)

`AvatarRawToolData` の使い方は簡単で、コンポーネントをつければアバターを着た際にコントローラーの値がそこで取得されます。
ただし使用できるのは以下の5つのみです：
*   `Primary`
*   `Secondary`
*   `Grab`
*   `PrimaryStrength`
*   `SecondaryAxis`

![alt text](<2025-11-26 17.23.13.webp>)

これらの値をFluxでシェイプキーにドライブするか、以下のように制御しましょう。

*   `MultiBoolConditionDriver` と `BooleanValueDriver<float>` を使用
*   ロジック例：「`Primary` false & `Secondary` false & `Grab` true の場合、このシェイプキーを1にする」
*   `SmoothValue` などを組み合わせると滑らかになります。

![alt text](<2025-11-26 17.24.20.webp>)

Fluxとコンポーネントでこれだけ差があるのはバグの可能性が高いそうなので、誰かIssueを書いてください。

## 足の接地
![alt text](<2025-11-24 18.03.17.webp>)

デフォルトのままだと足が地面にめり込んでいたり浮いていたりするので、ちゃんと接地するようにしましょう。

アバタールートに元々ついている `LocomotionAnimationFeetMetrics` というコンポーネントの `FootHeight` にチェックをつけ、適切な値を設定します。
![alt text](<2025-11-24 18.04.40.webp>)

## 未使用ボーン・シェイプキー削除

### ボーン削除
`Bone(list)` に入っているボーンが多いと読み込みに時間がかかります。未使用のボーンはボタン一つで削除できるので整理しましょう。
`SkinnedMeshRenderer` の下部にある `空のボーンの除去` ボタンを押してください。
![alt text](<2025-11-26 15.27.06.webp>)

### シェイプキー削除
シェイプキーも数が多いと読み込みに時間がかかります。
`SkinnedMeshRenderer` の下部にある `使用していないブレンドシェイプを除去` ボタンを押して削除しましょう。
![alt text](<2025-11-26 15.27.51.webp>)

## メッシュベイク

アバターに `SkinnedMeshRenderer` が複数あると、それだけドローコールが増え、処理に時間がかかります。普段使いするアバターはメッシュをベイクしてまとめましょう。

**注意**: 現状のResoniteでは、顔のようなシェイプキーが多いメッシュを体とまとめてしまうと逆に重くなる場合があるらしいので、**「顔」と「顔以外」のように分けるのがおすすめ** です。

**手順**:
1.  グルーツールを `スキンドメッシュをベイク` のモードにします。
    ![alt text](<2025-11-26 15.54.15.webp>)
2.  ベイクしたいメッシュを一つのスロットの子供にまとめ、親スロットを掴みながらセカンダリを押します。
    ![alt text](<2025-11-26 15.59.44.webp>)
3.  ベイクをするとメッシュのアセットが別物になるので、DevToolの「新規作成」→「アセット最適化ウィザード」を出します。
    ![alt text](<2025-11-26 16.07.28.webp>)
4.  リファレンスにアバタールート（またはAssetスロット）を入れて `使われていないアセットを削除` を実行します。
    ![alt text](<2025-11-26 16.08.07.webp>)
5.  このままだとベイク後のアセットがルートのAssetsスロットに出てしまうので、ベイクした `SkinnedMeshRenderer` の `Mesh` の中身を掴んで、アバターのAssetsスロットの適当な場所に移動しておきましょう。

## テクスチャ

### アルファ除去
アルファを使用していないテクスチャはアルファの除去を行いましょう。
同じように見えるテクスチャでも、アルファ情報を消すだけでVRAMの使用量をかなり削減できます。

テクスチャアセットの下部にある `アルファを取り除く` ボタンを押してください。
![alt text](<2025-11-26 16.37.56.webp>)

**効果**:
*   アルファ除去前: 21.33MB（圧縮形式がBC3）
    ![alt text](<2025-11-26 16.38.16.webp>)
*   アルファ除去後: 10.67MB（圧縮形式がBC1）
    ![alt text](<2025-11-26 16.39.58.webp>)

### 解像度
自分が許容できるギリギリまで解像度を低くしましょう。
`再調整` の左にリサイズしたい解像度の長辺を入力して `再調整` を押します。
![alt text](<2025-11-26 16.38.41.webp>)

## マテリアル

できるだけまとめましょう。
アバターによっては同じテクスチャなのにパーツ毎にマテリアルが分かれていたりするので、特別な理由がない限りは統合します。

*   **マテリアルの種類**: 可能ならPBS系の不透明を使いましょう。発光しているものにはUnlitを使います。
*   **Toonシェーダー**: Toon調にしたい箇所のみXiexeToonにしましょう。
*   **BlendMode**: 透過テクスチャを使っているマテリアルもできるだけ `Cutout` にし、どうしても半透明にしたい箇所のみ `Alpha` にしましょう。

## ロコモーション

`LocomotionAnimationConfiguration` コンポーネントを適当なスロットに「コンポーネントをアタッチ」から新しくつけましょう。
![alt text](<2025-11-26 17.16.28.webp>)

`Gaits(list)` の中に0, 1, 2, 3の計4つのパラメーターがあり、移動速度別に分かれています。
もっとも移動速度が速いときのパラメーターが **3** なのですが、この3のアニメーションは足が大股で動きすぎるため、削除することをおすすめします。
![alt text](<2025-11-26 17.17.48.webp>)
